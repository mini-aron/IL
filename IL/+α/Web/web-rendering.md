## web-rendering
### 1. DNS 조회
1. 유저는 웹 브라우저의 IP주소를 얻기위해 DNS서버에 요청을 보낸다.
2. DNS서버에 요청을 보내게 되면 서버는 데이터베이스를 검색하거나 다른 DNS서버에 연결해 해당 도메인 이름과 연결된IP주소를 찾아 응답한다.
    + 최초의 요청이후 IP는 일정기간동안 캐시된다.
3. DNS서버에 재요청을 하는 대신 캐시에서 IP 주소를 검색해 요청속도를 높인다!

### 2. TCP 핸드셰이크 
IP주소를 얻은 후에는, 서버와 TCP 핸드셰이크를 통해 연결을 설정한다.  
이 방식은 데이터를 전송하기전에 통신하려는 브라우저와 웹 서버가 TCP소켓연결을 위한 매개변수를 주고 받을 수 있도록 만들어졌다.

### 3. TLS 협상(TLS Negotiation)

### 4. 응답( Response )
웹 서버로 한 번 연결이 되고 나면 브라우저는 유저 대신에 초기 HTTP request(GET)를 보낸다. 보통 HTML파일을 요청하며, 서버가 요청을 받으면 관련 응답 해더와 함께 html의 내용을 응답하게 된다.

### 5. 파싱(Parsing)
+ 브라우저가 첫 번째 데이터의 청크를 받으면, 구문을 분석하기 시작한다.
+ 파싱은 브라우저가 네트워크를 통해 받은 데이터를 DOM이나 CSSOM으로 바꾸는 단계다.

+ 브라우저는 마크업을 내부적으로 DOM으로 표현한다.  
+ DOM은 공개되어있고 js의 다양한 API를 통해 조작이 가능하다.
## 렌더링 과정
### 6. DOM트리 구축
+ 가장 첫 단계로  html을 처리해 DOM트리로 만든다.
+ DOM트리는 문서의 내용을 설명한다. html요소는 DOM트리의 루트 노드다.
+ DOM트리는 태그간의 관계와 계층을 반영한다. 노드의 수가 많아질수록 구축에 더 오랜시간이 든다.
![image](https://github.com/mini-aron/IL/assets/105274015/cdc70463-411e-4cdc-82be-6e335d9e10dc)

+ 구문 분석기가 이미지와 같은 논 블로킹 자원을 발견하면 브라우저는 해당 자원을 요청하고 분석을 계속한다.
+ 구문분석은 css파일을 만난 후에도 지속될 수 있다. 하지만 async, defer 같은 설정이 되어있지 않은 `script`태그는 렌더링을 막고, html의 분석을 중단시킨다. 이 때문에 과도한 스크립트는 속도 저하의 큰 원인이 될 수 있다.

#### 프리로드 스캐너(PreLoad Scanner)
+ 브라우저가 DOM 트리를 만드는 프로세스를 메인 쓰레드를 차지한다. 때문에, 프리로드 스캐너는 사용가능 컨텐츠를 분석하고 우선순위가 높은 자원을 요청한다.(Css, Javascript, 웹 폰트 등등)
+ 프리로드 스캐너가 자원을 뒤에서 미리 요청 -> 구문분석기가 외부 자원에 대한 참조를 찾아 요청할때까지 기다리지않는다.
+ 프리로드 스캐너가 제공하는 최적화는 블록킹을 줄여준다.
```html
<link rel="stylesheet" src="styles.css" />
<script src="myscript.js" async></script>
<img src="myimage.jpg" alt="image description" />
<script src="anotherscript.js" async></script>
```
위 코드에서 메인쓰레드가 HTML,CSS를 분석하고 있을 때, 프리로드 스캐너는 script와img를 찾아 다운로드하기 시작한다.
CSS를 다운로드하는 것은 HTML분석이나 다운로드를 막지않지만 Javascript의 실행은 막는다, JS는 가끔 요소에 영향을 주는 Css속성을 변경하기 때문이다.

### CSSOM트리 구축
+ CSSOM은 DOM과 같이 트리구조며, 둘은 각각 독립적인 자료구조다.
1. 브라우저는 CSS에 있는 규칙을 이해할 수 있도록 스타일 맵으로 변환한다.
2. 브라우저는 CSS에 있는 각각의 규칙을 읽고 트리노드를 만든다. 노드는 CSS 선택기에 기반해 여러 관계들의 노드가 만들어진다.(부모,자식,형제관계의 노드)
3. 브라우저는 전송받은 CSS규칙을 작업가능상태로 변환하는데, 따라 HTML객체로 바꾼 프로세스를 CSS에서 다시한번 더 한다.

+ CSSOM 트리는 사용자 에이전트의 스타일 시트를 포함한다.
브라우저는 노드에 적용 가능한 일반적 규칙부터 적용한다.
그리고 재귀적으로 구체적으로 적용된 규칙에 따라 스타일을 수정해간다.
다른말로 속성값을 캐스케이드한다고 한다.

+ CSSOM을 만드는데 드는 시간은 DNS 하나를 조회하는 시간보다 짧아 웹성능 최적화 관점으론 큰 기여를 할 수 있는 영역은 아니다.

### javascript 컴파일
CSS 가 분석되고 CSSOM이 생기는 동안, 프리로드 스캐너 덕에 js파일같은 자원도 다운로드된다.  
일부 브라우저는 추상 구문 트리를 인터프리터에게 넘긴다.  
그 결과 메인 쓰레드에서 실행되는 바이트코드가 생성된다.

### 접근성 트리 구축
브라우저는 접근성 트리를 구축한다.  
보조장치는 이 트리를 통해 내용을 분석,해석한다.  
브라우저는 DOM이 업데이트 될 때 접근성 트리도 업데이트 한다.

